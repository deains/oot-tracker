define(["model/Area","model/Check","json!data/areas.json","json!data/checks.json"],function(e,t,a,r){function n(e){this.app=e,this.prepareChecks(r),this.prepareAreas(a)}return n.prototype.getArea=function(e){if(!(e in this.areas))throw"Unrecognised area: "+e;return this.areas[e]},n.prototype.getAreaByName=function(e){if(!(e in this.areasByName))throw"Unrecognised area: "+e;return this.areasByName[e]},n.prototype.getCheck=function(e){if(!(e in this.checks))throw"Unrecognised check ID: "+e;return this.checks[e]},n.prototype.getAllAreas=function(){var e=[];for(var t in this.areas)this.areas.hasOwnProperty(t)&&e.push(this.getArea(t));return e},n.prototype.getAllChecks=function(){var e=[];for(var t in this.checks)this.checks.hasOwnProperty(t)&&e.push(this.getCheck(t));return e},n.prototype.createArea=function(t,a){var r=new e(this.app.getStore(),t.name,t.class,t.type,t.keys,t.mapcompass,t.label,a);return this.updateAreaCount(r),r.getElement().addEventListener("click",function(){this.app.getList().changeArea(r)}.bind(this)),a.forEach(function(e){e.setArea(r)},this),this.app.getEvents().add("Reset",function(){r.reset(),this.updateAreaCount(r)}.bind(this)),this.app.getEvents().add("Reload",function(){this.updateAreaCount(r)}.bind(this)),r},n.prototype.createCheck=function(e){var a=new t(this.app.getStore(),e.name,e.type,e.location,e.requires);return a.getElement().addEventListener("click",function(e){switch(e.button){case 0:a.toggleState("checked"),this.updateAreaCount(a.getArea());break;case 1:a.toggleState("barren"),this.updateAreaCount(a.getArea())}}.bind(this)),a.getElement().addEventListener("touchend",function(){a.toggleState("checked"),this.updateAreaCount(a.getArea())}.bind(this)),a.getElement().addEventListener("contextmenu",function(e){a.removeState("checked"),this.updateAreaCount(a.getArea()),e.preventDefault()}.bind(this)),this.app.getEvents().add("Reset",function(){a.reset()}),a},n.prototype.getChecksByArea=function(e){return e in this.checksByArea?this.checksByArea[e]:[]},n.prototype.prepareAreas=function(){this.areas={},this.areasByName={};for(var e in a)if(a.hasOwnProperty(e)){var t=this.createArea(a[e],this.getChecksByArea(e));this.areas[t.getID()]=t,this.areasByName[e]=t}},n.prototype.prepareChecks=function(){this.checks={},this.checksByArea={};for(var e in r)if(r.hasOwnProperty(e)){var t=this.createCheck(r[e]);t.getLocation()in this.checksByArea||(this.checksByArea[t.getLocation()]=[]),this.checks[t.getID()]=t,this.checksByArea[t.getLocation()].push(t)}},n.prototype.updateAreaCount=function(e){var t=e.getChecks().filter(function(e){return-1===this.app.getCountExclusions().indexOf(e.getType())&&e.meetsRequirements(this.app.getSettings())&&!(e.hasState("checked")||e.hasState("barren"))},this).length;e.setCompletionCount(t)},n});