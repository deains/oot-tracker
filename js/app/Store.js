define(["model/Area"],function(t){function e(t,e,s){this.app=t,this.storage=e,this.storageKey=s,this.save={},this.import()}return e.prototype.saveFrom=function(e){var s={state:e.getState()};e instanceof t&&(s.keys={small:e.getSmallKeyCount(),big:e.getBigKeyCount()}),this.setSaveItem(this.getModelKey(e),s)},e.prototype.loadTo=function(e){var s=this.getSaveItem(this.getModelKey(e));null!==s&&("state"in s&&e.loadState(s.state),"keys"in s&&e instanceof t&&e.loadKeyCounts(s.keys.small||0,s.keys.big||0))},e.prototype.getSettings=function(){return this.settings||null},e.prototype.setSettings=function(t){this.settings=t,this.export()},e.prototype.reset=function(){this.save={},this.export()},e.prototype.getModelKey=function(t){return t.constructor.name+":"+t.getID()},e.prototype.getSaveItem=function(t){return t in this.save&&"object"==typeof this.save[t]?this.save[t]:null},e.prototype.setSaveItem=function(t,e){this.save[t]=e,this.export()},e.prototype.getSave=function(){return this.save},e.prototype.import=function(){try{var t=this.storage.getItem(this.storageKey)}catch(t){return!1}if("string"==typeof t){try{t=JSON.parse(t)}catch(t){return!1}return"object"==typeof t.save&&(this.save=t.save),"object"==typeof t.settings&&(this.settings=t.settings),!0}return!1},e.prototype.export=function(){try{this.storage.setItem(this.storageKey,JSON.stringify({save:this.getSave(),settings:this.getSettings()}))}catch(t){}},e});