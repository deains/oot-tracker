define(["model/Area"],function(t){function e(t,e,s){this.app=t,this.storage=e,this.storageKey=s,this.save={},this.import()}return e.prototype.saveFrom=function(t){var e={state:t.getState()};this.setSaveItem(this.getModelKey(t),e)},e.prototype.loadTo=function(t){var e=this.getSaveItem(this.getModelKey(t));null!==e&&"state"in e&&t.loadState(e.state)},e.prototype.getSettings=function(){return this.settings||null},e.prototype.setSettings=function(t){this.settings=t,this.export()},e.prototype.reset=function(){this.save={},this.export()},e.prototype.getModelKey=function(t){return t.constructor.name+":"+t.getID()},e.prototype.getSaveItem=function(t){return t in this.save&&"object"==typeof this.save[t]?this.save[t]:null},e.prototype.setSaveItem=function(t,e){this.save[t]=e,this.export()},e.prototype.getSave=function(){return this.save},e.prototype.import=function(){try{var t=this.storage.getItem(this.storageKey)}catch(t){return!1}if("string"==typeof t){try{t=JSON.parse(t)}catch(t){return!1}return"object"==typeof t.save&&(this.save=t.save),"object"==typeof t.settings&&(this.settings=t.settings),!0}return!1},e.prototype.export=function(){try{this.storage.setItem(this.storageKey,JSON.stringify({save:this.getSave(),settings:this.getSettings()}))}catch(t){}},e});